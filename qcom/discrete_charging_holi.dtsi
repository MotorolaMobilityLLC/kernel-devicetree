/* Copyright (c) 2021, The Linux Foundation. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */
#include <dt-bindings/iio/qti_power_supply_iio.h>
#include "sgm7220.dtsi"
#include "discrete-rt-pd-manger.dtsi"

&pm6125_vadc {
	gpio6_div3{
		reg = <ADC5_GPIO3_DIV3>;
		label = "gpio3_div3";
		qcom,pre-scaling = <1 3>;
	};
};

&pm6125_gpios {
	gpio6_adc{
		gpio6_adc_default:gpio6_adc_default{
			pins = "gpio6";
			function = "normal";
			bias-high-impedance;
		};
	};
};

&qupv3_se8_i2c {
	status = "okay";
	cw2217@64 {
		compatible = "cellwise,cw2217";
		reg = <0x64>;
		status = "okay";

		df-serialnum = "SB18D24973";
		#include "bat_setting/CW_nd50-atl-5000mah.dtsi"
		#include "bat_setting/CW_nd50-jiade-5000mah.dtsi"
	};

	sm5602@71 {
		compatible = "sm,sm5602";
		reg = <0x71>;
		//interrupt-parent = <&tlmm>;
		//interrupts = <38 2>;
		//qcom,irq-gpio = <&tlmm 38 0x0>;

		sm,en_temp_ex;
		//sm,en_temp_in;
		sm,en_batt_det;
		//sm,iocv_man_mode;
		sm,misc = <0x0800>;
		sm,aging_ctrl = <0x0125>;
		sm,cycle_cfg = <0x7000>;
		sm,rsns = <1>;
		sm,fg_irq_set = <0x07FF>;
		sm,low_soc1 = <1>;
		sm,low_soc2 = <15>;
		sm,v_l_alarm = <3400>;
		sm,v_h_alarm = <4450>;
		sm,battery_table_num = <0>;
		sm,param_version = <3>;
		sm,t_l_alarm_in = <54>;
		sm,t_h_alarm_in = <1>;
		sm,t_l_alarm_ex = <0xD3D8>;
		sm,t_h_alarm_ex = <0x9245>;
		battery_params {
		//battery,id = <0>;
	    	//ND50(ATL)
		battery0,param_version = <3>;
	    	battery0,max_voltage_uv = <4450000>;
	        battery0,battery_type = <4450 0x0 0x26CC>;
	    	battery0,battery_table0 = <0x1400 0x1CA1 0x1D13 0x1D75 0x1D8B 0x1D8E 0x1D97 0x1DC4
						0x1DF4 0x1E1B 0x1E4A 0x1E78 0x1EC8 0x1F28 0x1F6E 0x1FAB
						0x1FFE 0x20C8 0x2174 0x21F0 0x2247 0x22EE 0x2340 0x2733>;
	    	battery0,battery_table1 = <0x0 0x83 0x18B 0x316 0x526 0x62E 0x946 0xC5E 0x107E 0x15A5
						0x1ACD 0x2288 0x2CD8 0x3493 0x3727 0x39BB 0x3EE2 0x4931
						0x50ED 0x5614 0x59B0 0x60E8 0x6400 0x64E6>;
		battery0,battery_table2 = <0x1E2E 0x1719 0x1415 0x1112 0x1010 0x0F0F 0x0E0E 0x0E0E>;
		battery0,alpha = <0x00CC>;
		battery0,beta = <0x0025>;
		battery0,rs = <0x805F>;
		battery0,rs_value = <0x0050 0x010A 0x3800 0x0048>;
		battery0,vit_period = <0x325A>;
		battery0,volt_cal = <0x8000>;
		battery0,mix_value = <0x0003>;
		battery0,curr_offset = <0x000>;
		battery0,curr_slope = <0x8080>;
		battery0,topoff_soc = <7 343>;
		battery0,temp_std = <25>;
		battery0,temp_offset = <0 11 1 0 8 (-1)>;
		battery0,temp_cal = <0 6 1 11 (-1) 0 6 1 9 1>;
		battery0,ext_temp_cal = <0 2 1 2 1 0 2 3 2 3>;
		battery0,tem_poff = <3400 100>;
	        battery0,thermal_table = <0x3CAB 0x365A 0x3025 0x2A24 0x2436 0x1E74 0x18D7 0x13A6 0x0E6F 0x0963
						0x047E 0xF78B 0xF2F2 0xEE7D 0xEA3D 0xE629 0xE23C 0xDE7B 0xDAE1 0xD769
						0xD414 0xD0E7 0xCDDA 0xCAEF 0xC827 0xC57C 0xC2EE 0xC07F 0xBE2D 0xBBF2
						0xB9D5 0xB7CE 0xB5E1 0xB409 0xB248 0xB09A 0xAF03 0xAD7D 0xAC08 0xAAA8
						0xA957 0xA818 0xA6DD 0xA5BD 0xA4A7 0xA39C 0xA2A1 0xA1B1 0xA0CA 0x9FF3
						0x9F22 0x9E58 0x9D99 0x9CE6 0x9C3B 0x9B94 0x9AF6 0x9A61 0x99D2 0x994B
						0x98CB 0x984E 0x97D6 0x9765 0x96FA 0x9693 0x9632 0x95D4 0x9579 0x9522
						0x94D0 0x9481 0x9435 0x93EC 0x93A6 0x9364 0x9325 0x92EA 0x92B1 0x927B
						0x9246 0x9212 0x91E1 0x91B2 0x9185 0x915A 0x9132 0x910B 0x90E6 0x90C2
						0x90A0 0x907F 0x905E 0x903F 0x9022 0x9005 0x8FEA 0x8FD0 0x8FB7 0x8F9F
						0x8F89>;  //NTC value(DEC) table -20~80
		//ND50(JIADE)
		battery1,param_version = <3>;
	    	battery1,max_voltage_uv = <4450000>;
	        battery1,battery_type = <4450 0x0 0x2699>;
	    	battery1,battery_table0 = <0x1400 0x1C5F 0x1CE0 0x1D63 0x1D87 0x1D90 0x1D95 0x1DB6
						0x1DE9 0x1E13 0x1E43 0x1E77 0x1EC9 0x1F24 0x1F54 0x1FA3
						0x2000 0x20C9 0x2178 0x21F3 0x2247 0x22EA 0x2331 0x2733>;
	    	battery1,battery_table1 = <0x0 0x83 0x18D 0x31B 0x4A9 0x6BB 0x8CE 0xBEA 0x100F 0x153D
						0x1A6C 0x2231 0x2C8E 0x3454 0x36EB 0x3983 0x3EB1 0x490E
						0x50D4 0x5602 0x59A3 0x60E4 0x6400 0x64E6>;
		battery1,battery_table2 = <0x2537 0x1C1F 0x1819 0x1415 0x1213 0x1011 0x1010 0x0F0F>;
		battery1,alpha = <0x00CC>;
		battery1,beta = <0x0025>;
		battery1,rs = <0x805F>;
		battery1,rs_value = <0x0050 0x010A 0x3800 0x0048>;
		battery1,vit_period = <0x325A>;
		battery1,volt_cal = <0x8000>;
		battery1,mix_value = <0x0003>;
		battery1,curr_offset = <0x000>;
		battery1,curr_slope = <0x8080>;
		battery1,topoff_soc = <7 343>;
		battery1,temp_std = <25>;
		battery1,temp_offset = <0 11 1 0 8 (-1)>;
		battery1,temp_cal = <0 6 1 11 (-1) 0 6 1 9 1>;
		battery1,ext_temp_cal = <0 2 1 2 0 0 2 3 2 3>;
		battery1,tem_poff = <3400 100>;
	        battery1,thermal_table = <0x3CAB 0x365A 0x3025 0x2A24 0x2436 0x1E74 0x18D7 0x13A6 0x0E6F 0x0963
						0x047E 0xF78B 0xF2F2 0xEE7D 0xEA3D 0xE629 0xE23C 0xDE7B 0xDAE1 0xD769
						0xD414 0xD0E7 0xCDDA 0xCAEF 0xC827 0xC57C 0xC2EE 0xC07F 0xBE2D 0xBBF2
						0xB9D5 0xB7CE 0xB5E1 0xB409 0xB248 0xB09A 0xAF03 0xAD7D 0xAC08 0xAAA8
						0xA957 0xA818 0xA6DD 0xA5BD 0xA4A7 0xA39C 0xA2A1 0xA1B1 0xA0CA 0x9FF3
						0x9F22 0x9E58 0x9D99 0x9CE6 0x9C3B 0x9B94 0x9AF6 0x9A61 0x99D2 0x994B
						0x98CB 0x984E 0x97D6 0x9765 0x96FA 0x9693 0x9632 0x95D4 0x9579 0x9522
						0x94D0 0x9481 0x9435 0x93EC 0x93A6 0x9364 0x9325 0x92EA 0x92B1 0x927B
						0x9246 0x9212 0x91E1 0x91B2 0x9185 0x915A 0x9132 0x910B 0x90E6 0x90C2
						0x90A0 0x907F 0x905E 0x903F 0x9022 0x9005 0x8FEA 0x8FD0 0x8FB7 0x8F9F
						0x8F89>;  //NTC value(DEC) table -20~80
	    };
	};

	sgm4154x: sgm4154x@3B {
		status = "okay";
		compatible = "sgm,sgm41542";
		reg = <0x3B>;

		pinctrl-names = "default";
		pinctrl-0 = <&gpio6_adc_default &chg_irq_default>;
		io-channels = <&pm6125_vadc ADC5_GPIO3_DIV3>;
		io-channel-names = "gpio3_div3";

		interrupt-parent = <&tlmm>;
		interrupts = <12 0>;            //irq num base on hardware design
		sgm,irq-gpio = <&tlmm 12 0>;     //irq num base on hardware design
		sgm,chg-en-gpio = <&tlmm 92 0>;   //gpio num base on hardware design  1.MTK parent node name is pio  2.QUALCOMM parent node name is tlmm or other

		dpdm-supply = <&qusb_phy0>;
		mmi,qc3-support;

		/* sw jeita  parameter customer defined*/
		enable_sw_jeita;
		jeita_temp_above_t4_cv = <0>;
		jeita_temp_t3_to_t4_cv = <4100000>;
		jeita_temp_t2_to_t3_cv = <4350000>;
		jeita_temp_t1_to_t2_cv = <4350000>;
		jeita_temp_t0_to_t1_cv = <0>;
		jeita_temp_below_t0_cv = <0>;

		jeita_temp_above_t4_cc_current = <0>;
		jeita_temp_t3_to_t4_cc_current = <1000000>;
		jeita_temp_t2_to_t3_cc_current = <1250000>;
		jeita_temp_t1_to_t2_cc_current = <1000000>;
		jeita_temp_below_t0_cc_current = <0>;

		temp_t4_thres = <50>;
		temp_t4_thres_minus_x_degree = <48>;
		temp_t3_thres = <45>;
		temp_t3_thres_minus_x_degree = <45>;
		temp_t2_thres = <20>;
		temp_t2_thres_plus_x_degree = <15>;
		temp_t1_thres = <0>;
		temp_t1_thres_plus_x_degree = <0>;
		temp_t0_thres = <0>;
		temp_t0_thres_plus_x_degree = <2>;
		temp_neg_10_thres = <0>;
	};

	bq25890@6A {
		status = "okay";
		compatible = "ti,bq2589x-1";
		reg = <0x6A>;

		pinctrl-names = "default";
		pinctrl-0 = <&bq2589x_irq &gpio6_adc_default>;
		io-channels = <&pm6125_vadc ADC5_GPIO3_DIV3>;
		io-channel-names = "gpio3_div3";

		bq2589x_irq-gpio = <&tlmm 12 0>;
		bq2589x_en-gpio = <&tlmm 92 0>;
		dpdm-supply = <&qusb_phy0>;

		mmi,qc3-support;
		ti,bq2589x,vbus-volt-high-level = <8700>;/* tune adapter to output 9v */
		ti,bq2589x,vbus-volt-low-level = <4400>;/* tune adapter to output 5v */
		ti,bq2589x,vbat-min-volt-to-tuneup = <3000>;
		ti,bq2589x,charge-voltage = <4450>;
		ti,bq2589x,charge-current = <3000>;
		ti,bq2589x,term-current = <128>;
		ti,bq2589x,enable-auto-dpdm;
		ti,bq2589x,enable-termination;
		ti,bq2589x,enable-ico;
		ti,bq2589x,use-absolute-vindpm;
	};
};

&soc {
	mmi_charger: mmi,charger {
		status = "ok";
		compatible = "mmi,mmi-charger";
		mmi,enable-charging-limit;
		mmi,upper-limit-capacity = <65>;
		mmi,lower-limit-capacity = <60>;
		mmi,heartbeat-interval = <100000>;
		mmi,dcp-power-max = <10000>;
		mmi,hvdcp-power-max = <15000>;
	};

	mmi_discrete_charger: mmi,discrete-charging {
		status = "ok";
		compatible = "mmi,mmi-discrete-charger";
		#io-channel-cells = <1>;
		battery-names = "battery";
		supplied-from = "mmi_battery";

		mmi,chrg-iterm-ma = <243>;
		mmi,fg-iterm-ma = <500>;
		mmi,max-fv-mv = <4450>;
		mmi,max-fcc-ma = <4000>;
		mmi,demo-fv-mv = <4000>;
		mmi,df-serialnum = "SB18D24973";
		mmi,mmi-temp-zones = <0 4200 1000 0>,
			<10 4250 2500 1000>,
			<15 0 2500 2500>,
			<45 0 4000 4000>,
			<60 4200 4000 0>;

		mmi,thermal-mitigation = <4000000 3000000 2500000
				2000000 1500000
				1200000 900000
				600000 300000>;
		};
};


&tlmm {

	chg_irq_default: chg_irq_default {
		/* IRQ */
		mux {
			pins = "gpio12";
			function = "gpio";
		};

		config {
			pins = "gpio12";
			bias-pull-up;
			drive-strength = <2>; /* 2 MA */
			input-enable;
		};
	};

	bq2589x_irq: bq2589x_irq {
		mux {
			pins = "gpio12";
			function = "gpio";
		};

		config {
			pins = "gpio12";
			drive-strength = <2>;
			bias-pull-up;
			input-enable;
		};
	};
};
